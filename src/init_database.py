import asyncio
import asyncpg
import os
from datetime import datetime, date

async def create_tables_and_seed():
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î —Å –Ω—É–ª—è"""
    
    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
    try:
        conn = await asyncpg.connect(
            host=os.getenv("DB__HOST", "db"),
            port=int(os.getenv("DB__PORT", "5432")),
            user=os.getenv("DB__USER", "admin"),
            password=os.getenv("DB__PASSWORD"),
            database=os.getenv("DB__NAME")
        )
        print("‚úÖ –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ PostgreSQL")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
        return

    try:
        print("üóÑÔ∏è –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î...")
        
        # ========== –°–û–ó–î–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶ ==========
        
        # –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS Role (
                role_id SERIAL PRIMARY KEY,
                role_name VARCHAR(50) NOT NULL UNIQUE
            );
        """)
        
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS Category (
                category_id SERIAL PRIMARY KEY,
                category_name VARCHAR(50) NOT NULL UNIQUE
            );
        """)
        
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS ApplicationStatus (
                status_id SERIAL PRIMARY KEY,
                status_name VARCHAR(50) NOT NULL UNIQUE
            );
        """)
        
        # –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS Users (
                user_id SERIAL PRIMARY KEY,
                telegram_id BIGINT NOT NULL UNIQUE,
                first_name VARCHAR(100) NOT NULL,
                last_name VARCHAR(100),
                middle_name VARCHAR(100)
            );
        """)
        
        # –¢–∞–±–ª–∏—Ü–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS Subject (
                subject_id SERIAL PRIMARY KEY,
                title VARCHAR(100) NOT NULL UNIQUE,
                description TEXT,
                code VARCHAR(20) UNIQUE
            );
        """)
        
        # –¢–∞–±–ª–∏—Ü–∞ –æ–ª–∏–º–ø–∏–∞–¥
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS Olympiad (
                olympiad_id SERIAL PRIMARY KEY,
                title VARCHAR(200) NOT NULL,
                description TEXT,
                organizer VARCHAR(150),
                start_date DATE NOT NULL,
                end_date DATE NOT NULL,
                subject_id INT NOT NULL REFERENCES Subject(subject_id) ON DELETE CASCADE
            );
        """)
        
        # –°–≤—è–∑—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS UserRole (
                user_role_id SERIAL PRIMARY KEY,
                user_id INT NOT NULL REFERENCES Users(user_id) ON DELETE CASCADE,
                role_id INT NOT NULL REFERENCES Role(role_id) ON DELETE RESTRICT,
                CONSTRAINT unique_user_role UNIQUE (user_id, role_id)
            );
        """)
        
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS UserCategory (
                user_category_id SERIAL PRIMARY KEY,
                user_id INT NOT NULL REFERENCES Users(user_id) ON DELETE CASCADE,
                category_id INT NOT NULL REFERENCES Category(category_id) ON DELETE RESTRICT,
                CONSTRAINT unique_user_category UNIQUE (user_id, category_id)
            );
        """)
        
        # –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS Application (
                application_id SERIAL PRIMARY KEY,
                olympiad_id INT NOT NULL REFERENCES Olympiad(olympiad_id) ON DELETE CASCADE,
                user_id INT NOT NULL REFERENCES Users(user_id) ON DELETE CASCADE,
                status_id INT NOT NULL REFERENCES ApplicationStatus(status_id) ON DELETE RESTRICT,
                created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
        """)
        
        # –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        await conn.execute("""
            CREATE TABLE IF NOT EXISTS Messages (
                message_id SERIAL PRIMARY KEY,
                user_id INT NOT NULL REFERENCES Users(user_id) ON DELETE CASCADE,
                application_id INT NOT NULL REFERENCES Application(application_id) ON DELETE CASCADE,
                message_text TEXT NOT NULL,
                sent_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
        """)
        
        print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
        
        # ========== –ó–ê–ü–û–õ–ù–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò ==========
        
        print("üìö –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏...")
        
        # –û—á–∏—Å—Ç–∫–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
        await conn.execute("TRUNCATE TABLE Messages, Application, UserCategory, UserRole, Olympiad, Users, Subject, ApplicationStatus, Category, Role RESTART IDENTITY CASCADE;")
        
        # –†–æ–ª–∏
        await conn.executemany(
            "INSERT INTO Role (role_name) VALUES ($1)",
            [('–°—Ç—É–¥–µ–Ω—Ç',), ('–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',), ('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',)]
        )
        
        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        await conn.executemany(
            "INSERT INTO Category (category_name) VALUES ($1)",
            [('–®–∫–æ–ª—å–Ω–∏–∫',), ('–°—Ç—É–¥–µ–Ω—Ç',), ('–ê—Å–ø–∏—Ä–∞–Ω—Ç',), ('–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å',)]
        )
        
        # –°—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–æ–∫
        await conn.executemany(
            "INSERT INTO ApplicationStatus (status_name) VALUES ($1)",
            [('–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ',), ('–û–¥–æ–±—Ä–µ–Ω–∞',), ('–û—Ç–∫–ª–æ–Ω–µ–Ω–∞',)]
        )
        
        # –î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
        subjects_data = [
            ('–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–û–ª–∏–º–ø–∏–∞–¥—ã –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ —Ä–∞–∑–ª–∏—á–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è', 'MATH'),
            ('–§–∏–∑–∏–∫–∞', '–û–ª–∏–º–ø–∏–∞–¥—ã –ø–æ —Ñ–∏–∑–∏–∫–µ –∏ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏–∏', 'PHYS'),
            ('–•–∏–º–∏—è', '–•–∏–º–∏—á–µ—Å–∫–∏–µ –æ–ª–∏–º–ø–∏–∞–¥—ã –∏ –∫–æ–Ω–∫—É—Ä—Å—ã', 'CHEM'),
            ('–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–û–ª–∏–º–ø–∏–∞–¥—ã –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é', 'INFO'),
            ('–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', '–ö–æ–Ω–∫—É—Ä—Å—ã –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º', 'PROG')
        ]
        await conn.executemany(
            "INSERT INTO Subject (title, description, code) VALUES ($1, $2, $3)",
            subjects_data
        )
        
        print("üë• –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...")
        
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ Telegram ID
        users_data = [
            (123456789, '–ê–¥–º–∏–Ω', '–°–∏—Å—Ç–µ–º–Ω—ã–π', '–ì–ª–∞–≤–Ω—ã–π'),           # ID=1, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
            (987654321, '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä', '–¢–µ—Å—Ç–æ–≤—ã–π', '–ò–≤–∞–Ω–æ–≤–∏—á'),       # ID=2, –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä  
            (111111111, '–ò–≤–∞–Ω', '–ü–µ—Ç—Ä–æ–≤', '–°–µ—Ä–≥–µ–µ–≤–∏—á'),             # ID=3, –°—Ç—É–¥–µ–Ω—Ç
            (222222222, '–ú–∞—Ä–∏—è', '–°–∏–¥–æ—Ä–æ–≤–∞', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞'),      # ID=4, –°—Ç—É–¥–µ–Ω—Ç
            (333333333, '–ê–ª–µ–∫—Å–µ–π', '–ö–æ–∑–ª–æ–≤', None),                 # ID=5, –°—Ç—É–¥–µ–Ω—Ç
            (444444444, '–ï–ª–µ–Ω–∞', '–í–æ–ª–∫–æ–≤–∞', '–î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞'),         # ID=6, –°—Ç—É–¥–µ–Ω—Ç
            (555555555, '–î–º–∏—Ç—Ä–∏–π', '–õ–µ–±–µ–¥–µ–≤', '–ê–Ω–¥—Ä–µ–µ–≤–∏—á'),        # ID=7, –°—Ç—É–¥–µ–Ω—Ç
            (666666666, '–ê–Ω–Ω–∞', '–ú–æ—Ä–æ–∑–æ–≤–∞', '–í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞')          # ID=8, –°—Ç—É–¥–µ–Ω—Ç
        ]
        await conn.executemany(
            "INSERT INTO Users (telegram_id, first_name, last_name, middle_name) VALUES ($1, $2, $3, $4)",
            users_data
        )
        
        # –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π (user_id, role_id)
        roles_data = [
            (1, 3),  # –ê–¥–º–∏–Ω -> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
            (2, 2),  # –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä -> –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä
            (3, 1), (4, 1), (5, 1), (6, 1), (7, 1), (8, 1)  # –û—Å—Ç–∞–ª—å–Ω—ã–µ -> –°—Ç—É–¥–µ–Ω—Ç
        ]
        await conn.executemany(
            "INSERT INTO UserRole (user_id, role_id) VALUES ($1, $2)",
            roles_data
        )
        
        # –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (user_id, category_id)
        categories_data = [
            (1, 4), (2, 4),  # –ê–¥–º–∏–Ω –∏ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä -> –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
            (3, 2), (4, 2), (5, 2),  # –ò–≤–∞–Ω, –ú–∞—Ä–∏—è, –ê–ª–µ–∫—Å–µ–π -> –°—Ç—É–¥–µ–Ω—Ç
            (6, 1),  # –ï–ª–µ–Ω–∞ -> –®–∫–æ–ª—å–Ω–∏–∫
            (7, 3),  # –î–º–∏—Ç—Ä–∏–π -> –ê—Å–ø–∏—Ä–∞–Ω—Ç
            (8, 4)   # –ê–Ω–Ω–∞ -> –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
        ]
        await conn.executemany(
            "INSERT INTO UserCategory (user_id, category_id) VALUES ($1, $2)",
            categories_data
        )
        
        print("üèÜ –°–æ–∑–¥–∞–µ–º –æ–ª–∏–º–ø–∏–∞–¥—ã...")
        
        # –û–ª–∏–º–ø–∏–∞–¥—ã (–≤–∫–ª—é—á–∞—è –∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞ –∏—é–Ω—å 2025)
        olympiads_data = [
            # –ê–ö–¢–ò–í–ù–´–ï –ù–ê –ò–Æ–ù–¨ 2025 (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            ('–õ–µ—Ç–Ω—è—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ', 
             '–õ–µ—Ç–Ω–∏–π —Ç—É—Ä –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ª–∏–º–ø–∏–∞–¥—ã –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. –í–∫–ª—é—á–∞–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º –≤—ã—Å—à–µ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏.', 
             '–õ–µ—Ç–Ω—è—è —à–∫–æ–ª–∞ –ú–ì–£', 
             date(2025, 6, 1), date(2025, 6, 30), 1),
             
            ('–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω "–õ–µ—Ç–æ –ö–æ–¥–∞"', 
             '–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é. –ó–∞–¥–∞—á–∏ –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º –¥–∞–Ω–Ω—ã—Ö –∏ –æ–ª–∏–º–ø–∏–∞–¥–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é.', 
             '–Ø–Ω–¥–µ–∫—Å', 
             date(2025, 6, 5), date(2025, 6, 20), 5),
             
            ('–í–µ—Å–µ–Ω–Ω–µ-–ª–µ—Ç–Ω—è—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞', 
             '–û–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ —Ñ–∏–∑–∏–∫–µ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.', 
             '–ú–§–¢–ò –õ–µ—Ç–Ω—è—è —à–∫–æ–ª–∞', 
             date(2025, 5, 25), date(2025, 6, 15), 2),
             
            ('–•–∏–º–∏—á–µ—Å–∫–∏–π —Ç—É—Ä–Ω–∏—Ä "–ù–∞—á–∞–ª–æ –ª–µ—Ç–∞"', 
             '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ —Ö–∏–º–∏–∏ —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏ –∏ —Å–∏–Ω—Ç–µ–∑–æ–º –≤–µ—â–µ—Å—Ç–≤.', 
             '–•–∏–º–§–∞–∫ –ú–ì–£', 
             date(2025, 6, 8), date(2025, 6, 25), 3),
             
            ('IT-—Ö–∞–∫–∞—Ç–æ–Ω "–¶–∏—Ñ—Ä–æ–≤–æ–µ –ª–µ—Ç–æ"', 
             '–ö–æ–º–∞–Ω–¥–Ω—ã–π —Ö–∞–∫–∞—Ç–æ–Ω –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤.', 
             'Mail.ru Group', 
             date(2025, 6, 10), date(2025, 6, 12), 4),
            
            # –ë–£–î–£–©–ò–ï –û–õ–ò–ú–ü–ò–ê–î–´
            ('–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ú–ì–£ 2025', 
             '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã—Å—à–∏—Ö —É—á–µ–±–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π.', 
             '–ú–ì–£ –∏–º. –ú.–í. –õ–æ–º–æ–Ω–æ—Å–æ–≤–∞', 
             date(2025, 9, 15), date(2025, 11, 30), 1),
             
            ('–§–∏–∑–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ú–§–¢–ò', 
             '–í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ —Ñ–∏–∑–∏–∫–µ —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º —É—á–∞—Å—Ç–∏–µ–º.', 
             '–ú–§–¢–ò', 
             date(2025, 10, 1), date(2025, 12, 15), 2),
             
            ('–•–∏–º–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –°–ü–±–ì–£', 
             '–û–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ –æ–±—â–µ–π, –Ω–µ–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–π, –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–π –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π —Ö–∏–º–∏–∏.', 
             '–°–ü–±–ì–£', 
             date(2025, 10, 15), date(2025, 12, 20), 3)
        ]
        await conn.executemany(
            "INSERT INTO Olympiad (title, description, organizer, start_date, end_date, subject_id) VALUES ($1, $2, $3, $4, $5, $6)",
            olympiads_data
        )
        
        print("üìã –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏...")
        
        # –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–ª–∏–º–ø–∏–∞–¥—ã
        applications_data = [
            # ===== –õ–ï–¢–ù–Ø–Ø –û–õ–ò–ú–ü–ò–ê–î–ê –ü–û –ú–ê–¢–ï–ú–ê–¢–ò–ö–ï (ID=1) =====
            (1, 3, 2, datetime(2025, 6, 2, 10, 0)),   # –ò–≤–∞–Ω, –æ–¥–æ–±—Ä–µ–Ω–∞
            (1, 4, 1, datetime(2025, 6, 3, 14, 30)),  # –ú–∞—Ä–∏—è, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (1, 6, 3, datetime(2025, 6, 4, 9, 15)),   # –ï–ª–µ–Ω–∞, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
            (1, 8, 2, datetime(2025, 6, 5, 16, 45)),  # –ê–Ω–Ω–∞, –æ–¥–æ–±—Ä–µ–Ω–∞
            
            # ===== –ü–†–û–ì–†–ê–ú–ú–ò–°–¢–°–ö–ò–ô –ú–ê–†–ê–§–û–ù (ID=2) =====
            (2, 5, 1, datetime(2025, 6, 6, 9, 15)),   # –ê–ª–µ–∫—Å–µ–π, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (2, 7, 2, datetime(2025, 6, 7, 11, 45)),  # –î–º–∏—Ç—Ä–∏–π, –æ–¥–æ–±—Ä–µ–Ω–∞
            (2, 3, 1, datetime(2025, 6, 8, 13, 20)),  # –ò–≤–∞–Ω, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (2, 4, 2, datetime(2025, 6, 9, 8, 30)),   # –ú–∞—Ä–∏—è, –æ–¥–æ–±—Ä–µ–Ω–∞
            (2, 6, 3, datetime(2025, 6, 9, 19, 10)),  # –ï–ª–µ–Ω–∞, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
            
            # ===== –í–ï–°–ï–ù–ù–ï-–õ–ï–¢–ù–Ø–Ø –§–ò–ó–ò–ß–ï–°–ö–ê–Ø –û–õ–ò–ú–ü–ò–ê–î–ê (ID=3) =====
            (3, 6, 3, datetime(2025, 5, 26, 16, 20)), # –ï–ª–µ–Ω–∞, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
            (3, 3, 1, datetime(2025, 6, 1, 8, 30)),   # –ò–≤–∞–Ω, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (3, 7, 2, datetime(2025, 6, 2, 12, 15)),  # –î–º–∏—Ç—Ä–∏–π, –æ–¥–æ–±—Ä–µ–Ω–∞
            (3, 5, 1, datetime(2025, 6, 3, 17, 45)),  # –ê–ª–µ–∫—Å–µ–π, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (3, 8, 2, datetime(2025, 6, 4, 10, 30)),  # –ê–Ω–Ω–∞, –æ–¥–æ–±—Ä–µ–Ω–∞
            
            # ===== –•–ò–ú–ò–ß–ï–°–ö–ò–ô –¢–£–†–ù–ò–† (ID=4) =====
            (4, 4, 1, datetime(2025, 6, 9, 12, 0)),   # –ú–∞—Ä–∏—è, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (4, 7, 2, datetime(2025, 6, 9, 14, 30)),  # –î–º–∏—Ç—Ä–∏–π, –æ–¥–æ–±—Ä–µ–Ω–∞
            (4, 5, 1, datetime(2025, 6, 10, 8, 15)),  # –ê–ª–µ–∫—Å–µ–π, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (4, 8, 3, datetime(2025, 6, 10, 11, 45)), # –ê–Ω–Ω–∞, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
            
            # ===== IT-–•–ê–ö–ê–¢–û–ù (ID=5) =====
            (5, 5, 1, datetime(2025, 6, 10, 7, 0)),   # –ê–ª–µ–∫—Å–µ–π, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (5, 3, 1, datetime(2025, 6, 10, 9, 30)),  # –ò–≤–∞–Ω, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (5, 7, 2, datetime(2025, 6, 10, 11, 15)), # –î–º–∏—Ç—Ä–∏–π, –æ–¥–æ–±—Ä–µ–Ω–∞
            (5, 4, 1, datetime(2025, 6, 10, 13, 45)), # –ú–∞—Ä–∏—è, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            
            # ===== –ë–£–î–£–©–ò–ï –û–õ–ò–ú–ü–ò–ê–î–´ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤) =====
            # –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ú–ì–£ (ID=6)
            (6, 3, 1, datetime(2025, 6, 5, 15, 0)),   # –ò–≤–∞–Ω, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (6, 4, 1, datetime(2025, 6, 6, 16, 30)),  # –ú–∞—Ä–∏—è, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (6, 5, 2, datetime(2025, 6, 7, 10, 15)),  # –ê–ª–µ–∫—Å–µ–π, –æ–¥–æ–±—Ä–µ–Ω–∞
            
            # –§–∏–∑–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ú–§–¢–ò (ID=7)
            (7, 7, 1, datetime(2025, 6, 8, 14, 20)),  # –î–º–∏—Ç—Ä–∏–π, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (7, 6, 3, datetime(2025, 6, 9, 12, 45)),  # –ï–ª–µ–Ω–∞, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
            
            # –•–∏–º–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –°–ü–±–ì–£ (ID=8)
            (8, 8, 1, datetime(2025, 6, 10, 9, 0)),   # –ê–Ω–Ω–∞, –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
        ]
        await conn.executemany(
            "INSERT INTO Application (olympiad_id, user_id, status_id, created_date) VALUES ($1, $2, $3, $4)",
            applications_data
        )
        
        print("üí¨ –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤...")
        
        # –°–æ–æ–±—â–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∫ –∑–∞—è–≤–∫–∞–º
        messages_data = [
            # === –û–î–û–ë–†–ï–ù–ù–´–ï –ó–ê–Ø–í–ö–ò ===
            # –õ–µ—Ç–Ω—è—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ - –ò–≤–∞–Ω (application_id=1)
            (2, 1, '–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞! –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–ª–∏–º–ø–∏–∞–¥—ã. –°–ø–∏—Å–æ–∫ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ—á—Ç—É.', datetime(2025, 6, 2, 15, 0)),
            
            # –õ–µ—Ç–Ω—è—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ - –ê–Ω–Ω–∞ (application_id=4) 
            (1, 4, '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞. –û–∂–∏–¥–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è.', datetime(2025, 6, 5, 18, 0)),
            
            # –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω - –î–º–∏—Ç—Ä–∏–π (application_id=6)
            (1, 6, '–û—Ç–ª–∏—á–Ω–∞—è –∑–∞—è–≤–∫–∞! –ñ–¥—ë–º –≤–∞—Å –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ IDE –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.', datetime(2025, 6, 7, 12, 0)),
            
            # –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω - –ú–∞—Ä–∏—è (application_id=8)
            (2, 8, '–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞! –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.', datetime(2025, 6, 9, 10, 30)),
            
            # –§–∏–∑–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ - –î–º–∏—Ç—Ä–∏–π (application_id=12)
            (1, 12, '–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∑—è—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º.', datetime(2025, 6, 2, 14, 20)),
            
            # –§–∏–∑–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ - –ê–Ω–Ω–∞ (application_id=14)
            (2, 14, '–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞. –£–¥–∞—á–∏ –Ω–∞ –æ–ª–∏–º–ø–∏–∞–¥–µ! –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–æ–º –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è.', datetime(2025, 6, 4, 11, 45)),
            
            # –•–∏–º–∏—á–µ—Å–∫–∏–π —Ç—É—Ä–Ω–∏—Ä - –î–º–∏—Ç—Ä–∏–π (application_id=16)
            (1, 16, '–ü—Ä–∏–Ω—è—Ç–æ! –ë—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫—É—é —Ö–∏–º–∏—é –∏ —Ä–µ–∞–∫—Ü–∏–∏ –∫–æ–º–ø–ª–µ–∫—Å–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.', datetime(2025, 6, 9, 15, 15)),
            
            # IT-—Ö–∞–∫–∞—Ç–æ–Ω - –î–º–∏—Ç—Ä–∏–π (application_id=21)
            (2, 21, '–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞! –•–∞–∫–∞—Ç–æ–Ω –±—É–¥–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å 48 —á–∞—Å–æ–≤. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏ –∏–¥–µ–∏.', datetime(2025, 6, 10, 12, 30)),
            
            # –ë—É–¥—É—â–∏–µ –æ–ª–∏–º–ø–∏–∞–¥—ã
            (1, 25, '–ó–∞—è–≤–∫–∞ –Ω–∞ –ú–ì–£ –æ–¥–æ–±—Ä–µ–Ω–∞! –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –Ω–∞ —Å–∞–π—Ç–µ.', datetime(2025, 6, 7, 11, 0)),
            
            # === –û–¢–ö–õ–û–ù–ï–ù–ù–´–ï –ó–ê–Ø–í–ö–ò ===
            # –õ–µ—Ç–Ω—è—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ - –ï–ª–µ–Ω–∞ (application_id=3)
            (2, 3, '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∑–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –≤ –≤—ã—Å—à–µ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—á–∞—Å—Ç–∏–µ –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä—Å–∞—Ö.', datetime(2025, 6, 4, 10, 30)),
            
            # –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω - –ï–ª–µ–Ω–∞ (application_id=9)
            (1, 9, '–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –æ–ø—ã—Ç–∞ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —à–∫–æ–ª—å–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–∞—Ö.', datetime(2025, 6, 9, 20, 15)),
            
            # –§–∏–∑–∏—á–µ—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ - –ï–ª–µ–Ω–∞ (application_id=11)
            (2, 11, '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –±–∞–∑–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π –ø–æ —Ñ–∏–∑–∏–∫–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑.', datetime(2025, 5, 26, 17, 0)),
            
            # –•–∏–º–∏—á–µ—Å–∫–∏–π —Ç—É—Ä–Ω–∏—Ä - –ê–Ω–Ω–∞ (application_id=18)
            (1, 18, '–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞. –¢—Ä–µ–±—É—é—Ç—Å—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–µ –∑–Ω–∞–Ω–∏—è –Ω–µ–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–π —Ö–∏–º–∏–∏.', datetime(2025, 6, 10, 13, 0)),
            
            # –ë—É–¥—É—â–∏–µ –æ–ª–∏–º–ø–∏–∞–¥—ã
            (2, 26, '–ó–∞—è–≤–∫–∞ –Ω–∞ –ú–§–¢–ò –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞. –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.', datetime(2025, 6, 9, 14, 30)),
            
            # === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò ===
            # –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
            (1, 2, '–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –∫ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏.', datetime(2025, 6, 3, 16, 0)),
            (2, 5, '–†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –≤–∞—à—É –∑–∞—è–≤–∫—É. –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∏–∑–≤–µ—Å—Ç–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –¥–Ω–µ–π.', datetime(2025, 6, 6, 11, 30)),
            (1, 7, '–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏. –û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤.', datetime(2025, 6, 8, 14, 45)),
            (2, 15, '–î–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è. –†–µ—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–∏–Ω—è—Ç–æ –∑–∞–≤—Ç—Ä–∞.', datetime(2025, 6, 9, 13, 20)),
            (1, 19, '–ó–∞—è–≤–∫–∞ –ø–æ—Å—Ç—É–ø–∏–ª–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É. –û–∂–∏–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.', datetime(2025, 6, 10, 8, 45)),
        ]
        await conn.executemany(
            "INSERT INTO Messages (user_id, application_id, message_text, sent_date) VALUES ($1, $2, $3, $4)",
            messages_data
        )
        
        print("üéâ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!")
        
        # –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        user_count = await conn.fetchval("SELECT COUNT(*) FROM Users")
        olympiad_count = await conn.fetchval("SELECT COUNT(*) FROM Olympiad") 
        application_count = await conn.fetchval("SELECT COUNT(*) FROM Application")
        active_olympiad_count = await conn.fetchval("SELECT COUNT(*) FROM Olympiad WHERE '2025-06-10'::date BETWEEN start_date AND end_date")
        
        print(f"""
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î:
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {user_count}
   üèÜ –û–ª–∏–º–ø–∏–∞–¥: {olympiad_count}
   üìã –ó–∞—è–≤–æ–∫: {application_count}
   ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞ 10.06.2025: {active_olympiad_count}
        """)
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
        raise
    finally:
        await conn.close()
        print("üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î –∑–∞–∫—Ä—ã—Ç–æ")

if __name__ == "__main__":
    asyncio.run(create_tables_and_seed())
